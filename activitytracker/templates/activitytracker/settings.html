{% extends "base.html" %}
{% load staticfiles %}
{% load custom_templates %}

{% block css %}
    <link href="{% static 'activitytracker/css/slider.css' %}" rel="stylesheet">
    <link href="{% static 'bower_components/datatables/media/css/dataTables.bootstrap.min.css' %}" rel="stylesheet">
    <link href="https://cdn.datatables.net/responsive/1.0.7/css/responsive.bootstrap.css" rel="stylesheet">
    <link href="{% static 'bower_components/bootstrap-tokenfield/dist/css/bootstrap-tokenfield.min.css' %}" rel="stylesheet">

    <style>
        .ui-datepicker-year{
            display:none;
        }
    </style>
{% endblock %}


{% block content %}

    <ul class="breadcrumb">
        <li>
            <i class="icon-home"></i>
            <a href="{% url 'index' %}">Home</a>
        </li>
        <li><a href="#">Settings</a></li>
    </ul>
   <!-- Content begins HERE ------------------------------------------------------------------>
    <div class="row">
        <div class="box box-transparent col-sm-6 blue-black">
            <div class="box-header blueNavy" data-original-title>
                <h2 class="text-center"><i class="halflings-icon user white"></i><span class="break"></span>Profile Information</h2>
                <div class="box-icon">
                    <a href="#" class="btn-setting" data-toggle="modal" data-target="#routineModal"><i class="halflings-icon white calendar"></i></a>
                    <a href="#" class="btn-setting" data-toggle="modal" data-target="#editinfo"><i class="halflings-icon white edit"></i></a>
                    <a href="#" class="btn-setting" data-toggle="modal" data-target="#changepassword"><i class="halflings-icon white lock"></i></a>
                    <a href="#" class="btn-setting" data-toggle="modal" data-target="#deleteaccount"><i class="halflings-icon white ban-circle"></i></a>
                </div>
            </div>
            <div class="box-content">
                <table class="col-xs-12 user-info">
                    <tr>
                        <td>Username:</td>
                        <td id="Tblusername">{{ username }}</td>
                    </tr>
                    <tr>
                        <td>First Name:</td>
                        <td id="Tblfirstname">{{ firstname }}</td>
                    </tr>
                    <tr>
                        <td>Last Name:</td>
                        <td id="Tbllastname">{{ lastname }}</td>
                    </tr>
                    <tr>
                        <td>E-Mail Address:</td>
                        <td id="Tblemail">{{ email }}</td>
                    </tr>
                    <tr>
                        <td>Date of Birth:</td>
                        <td id="Tblbirth">{{ birth }}</td>
                    </tr>
                    <tr>
                      <td>Gender:</td>
                      <td id="Tblgender">{{ gender }}</td>
                    </tr>
                </table>
            </div>
            <div class="col-sm-12">
                <p id="successmsg" class="success-message text-center">&nbsp;</p>
            </div>
        </div>
        <div class="col-sm-6 box box-transparent">
            <div class="box-header blueNavy" data-original-title>
                <h2 class="text-center"><i class="icon-cloud white"></i><span class="break"></span>Available Providers</h2>
            </div>
            <div class="box-content row">
                <table id=ProvidersTable" class="col-xs-12 text-center user-providers">
                    <tbody>

                        {% for provider_name,provider_data in providerDomValues.items %}
                        <tr class="connected-app {{ provider_name }}">
                            <td ><img src="{% static 'activitytracker/img/'|add:provider_name|add:'.png' %}"/></td>
                            <td><span class="connected-app-text provider-name">{{ provider_name|capitalizeFirstLetter|removeDashes }}</span></td>
                            <td><span class="connected-app-text" style="color:{{ provider_data.statusFontColor }}"><i class='{{ provider_data.statusIcon }}'></i>&nbsp;{{ provider_data.statusText }}</span></td>
                            <td>
                                {% if provider_data.statusText == "App connected" %}
                                <a class="btn connected-app-button btn-blueNavy" onclick="synchronizeProvider('{{ provider_name }}')" title="Synchronize">
                                    <i class="halflings-icon refresh white" title="Synchronize"></i>
                                </a>
                                {% endif %}
                                <a onclick="appFunctionHandler('{{ provider_name }}')" class="btn connected-app-button btn-blueNavy" title="{{ provider_data.buttonText }}">
                                    <i class="halflings-icon {{ provider_data.buttonIcon }} white" title="{{ provider_data.buttonText }}"></i>
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class='row'>
        <div class="box box-transparent col-sm-6 blue-black">
            <div class="box-header blueNavy" data-original-title>
                <h2 class="text-center"><i class="halflings-icon map-marker white"></i><span class="break"></span>Personal Places</h2>
                <div class="box-icon">
                    <a href="#" class="btn-setting header-font-white" data-toggle="modal" data-target="#addPlaceModal"><i class="halflings-icon white plus"></i>add a place</a>
                </div>
            </div>
            <div class="box-content">
                <table id="PlacesTable" class="col-xs-12 user-places">
                    <thead class="places-header">
                        <tr>
                            <th>Place Name</th>
                            <th>Place Address</th>
                            <th class="never">Hidden Lat</th>
                            <th class="never">Hidden Lng</th>
                            <th>Options</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- data from dataTables -->
                    </tbody>
                </table>
            </div>
        </div>
    </div> {#  this row should close after the routine is ended. Move div properly #}
    <div class="row-fluid ">
        <div class="box span12 blue-black">
            <div class="box-header blue-black" data-original-title>
                <h2 align="center"><i class="icon-calendar white"></i><span class="break"></span>Daily Schedule Management</h2>
                <div class="box-icon">
                    <a href="#" class="btn-setting header-font-white" data-toggle="modal" data-target="#routineModal"><i class="halflings-icon white plus"></i>add recurring activity</a>
                </div>
            </div>
            <div class="box-content">
                <table id="RoutineTable" class="table table-striped table-bordered bootstrap-datatable datatable"><thead class="goal-header">
                    <thead class='goal-header'>
                        <tr>
                          <th style="min-width: 140px">Activity</th>
                          <th style="min-width: 140px">Title</th>
                          <th>Weekdays</th>
                          <th>Weekday Season</th>
                          <th>Weekend</th>
                          <th>Weekend Season</th>
                          <th>Options</th>
                        </tr>
                    </thead>
                    <tbody>

                        {% for activity, activity_data in routineActivities.items %}

                            <tr id="{{ activity|addDashes }}">

                                <td>
                                    <a class="quick-button metro circle routine-activity {{ activity_data.color }}">
                                        <i class="activicon-{{ activity_data.icon_classname }}"></i>
                                    </a>
                                </td>

                                <td>
                                    <p class="routine-activity-text">{{ activity }}</p>
                                </td>
                                <td>
                                    {% for weekday_log in activity_data.Weekdays %}
                                        <p>{{ weekday_log }}</p>
                                    {% endfor %}
                                </td>
                                <td>
                                    {% for weekday_seasonal_log in activity_data.Weekdays_seasonality %}
                                        <p>{{ weekday_seasonal_log }}</p>
                                    {% endfor %}
                                </td>
                                <td>
                                    {% for weekend_log in activity_data.Weekend %}
                                        <p>{{ weekend_log }}</p>
                                    {% endfor %}
                                </td>
                                <td>
                                    {% for weekend_seasonal_log in activity_data.Weekend_seasonality %}
                                        <p>{{ weekend_seasonal_log }}</p>
                                    {% endfor %}
                                </td>

                                <td>
                                    <a class="btn btn-info" href="#" onclick="initializeEditRoutineModal(this)">
                                        <i class="halflings-icon edit white"></i>
                                    </a>
                                    <a class="btn btn-info" href="#" onclick="deleteRoutine(this)">
                                        <i class="halflings-icon trash white"></i>
                                    </a>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

{% endblock %}

{% block modals %}

    <!-- Modal to add another place to your account -->
    <div class="modal fade" id="addPlaceModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header box-header blueNavy">
                    <button type="button" class="close" data-dismiss="modal">×</button>
                    <h2><i class="halflings-icon map-marker white"></i><span class="break" ></span>Add a new place</h2>
                </div>
                <form action="{% url 'places' %}" method="post" id="addPlaceForm" name="addPlaceForm">
                    {% csrf_token %}
                    <div class="modal-body">
                        <p>First, give this place a nickname:</p>
                        <div class="input-prepend row-fluid" title="Placename">
                            <span class="add-on"><i class="halflings-icon map-marker"></i></span>
                            <input class="input-large" name="placename" type="text" placeholder="Home, Work, etc"/>
                        </div>
                        <p>Then find it by giving the address in the map below:</p>
                        <div>
                           <input id="places-input" class="map-controls places-input" type="text" placeholder="Search for Places">
                            <div id="map-canvas" class="map-canvas"></div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <a href="#" class="btn btn-danger" data-dismiss="modal">Cancel</a>
                        <input type="button" class="btn btn-info" name="submitAddPlace" id="submitAddPlace" value="Add Place">
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- modal to edit a place -->
    <div class="modal fade" id="editPlaceModal">
        <form action="{% url 'places' %}" method="post" id="editPlaceForm" name="editPlaceForm" style="margin-bottom:0;">
            {% csrf_token %}
            <div class="modal-header ">
                <button type="button" class="close" data-dismiss="modal">×</button>
                <h4>Update Details of Place</h4>
            </div>
            <div class="modal-body" align="center">
                <p>Optionally, modify the nickname:</p
                        >
                <div class="input-prepend row-fluid" title="Placename">
                    <span class="add-on"><i class="halflings-icon map-marker"></i></span>
                    <input class="input-large" name="placename" type="text" placeholder="Home, Work, etc"/>
                </div>
                <p>Or change the location of the Place:</p>
                <div>
                   <input id="places-input-2" class="map-controls places-input" type="text" placeholder="Search for Places">
                    <div id="map-canvas-2" class="map-canvas"></div>
                </div>
            </div>
            <div class="modal-footer">
                <a href="#" class="btn btn-danger" data-dismiss="modal">Cancel</a>
                <input type="button" class="btn btn-info" name="submitEditPlace" id="editPlaceModalConfirm" value="Update Place">
            </div>
        </form>
    </div>

    <!-- Modal to Delete a Place -->
    <div class="modal fade" id="deletePlaceModal">
            <div class="modal-header ">
                <button type="button" class="close" data-dismiss="modal">×</button>
                <h4>Delete Place</h4>
            </div>
            <div class="modal-body" align="center">
                <p>Are you sure you want to delete this place?</p>
            </div>
            <div class="modal-footer">
                <a href="#" class="btn btn-info" data-dismiss="modal">Cancel</a>
                <input type="submit" class="btn btn-danger" name="submitDelete" id="deletePlaceModalConfirm" value="Delete">
            </div>
    </div>

    <!-- Modal to modify user's daily schedule -->
    <div class="modal fade" id="routineModal">
        <form method="POST" action="#" name="routineForm" id="routineForm">
            <div class="modal-header ">
                <button type="button" class="close" data-dismiss="modal">×</button>
                <h4>Organize Recurring Activities</h4>
            </div>
            <div class="modal-body" align="center" style="padding:35px">

                <p class='diversification-border'>Welcome to Activity Tracker. Tell us a bit about your habits</p>
                <div class="routine-canvas">

                    {% for activity, activity_data in routineActivities.iteritems %}

                        <div class='routine-container' id="{{ activity|addDashes }}">
                            <a title="{{ activity }}" class="quick-button metro circle routine-activity {{ activity_data.color }}">
                                <i class="activicon-{{ activity_data.icon_classname }}"></i>
                            </a>
                            <input name="routine-radiobutton" type="radio" value="{{ activity }}"/>
                        </div>

                    {% endfor %}
                </div>

                {% for extra_activity in routineExtraActivities%}

                    {% if forloop.counter0|divisibleby:5 %}<div class="hidden routine-canvas routine-canvas-show-more">{% endif %}

                        <div class='routine-container' id="{{ extra_activity.activity|addDashes }}">
                            <a title="{{ extra_activity.activity }}" class="quick-button metro circle routine-activity {{ extra_activity.color }}">
                                <i class="activicon-{{ extra_activity.icon_classname }}"></i>
                            </a>
                            <input name="routine-radiobutton" type="radio" value="{{ extra_activity.activity }}"/>
                        </div>
                    {% if forloop.counter|divisibleby:5 %} </div> {% endif %}

                {% endfor %}
                {% if not routineExtraActivities|length|divisibleby:5 %} </div> {% endif %}

                <a href='#'  class='underlined-link' id="routineInsertMore" onclick="routineInsertMore()">Show More</a>
                <div class="weekday-controls" style="margin-top:35px">
                    <i class="glyphicons-icon clock modal-icon"></i>
                    <select id="weekday-times" multiple="multiple" class="input-modal tokenfield" name="weekday-times"></select>
                    <div style="margin-left:20px;margin-top:10px">
                        <span id="weekday-range-from">08:00</span>&nbsp;&nbsp;&nbsp;
                        <input id="weekday-range-select" data-slider-id="weekday-slider" type="text">
                        &nbsp;&nbsp;&nbsp;<span id="weekday-range-to">17:15</span>
                    </div>
                    <div style="margin-top:10px">
                        <input type="button" id="log-weekday-time" value="Log time" class="btn btn-info"/>
                    </div>
                </div>
                <div id='weekend-controls' class=routine-controls'>
                    <div style="margin: 30px 0">
                        <label for="weekend">Weekends</label>
                        <a href="#"><i id='weekend' class="icon-chevron-down"></i></a>
                    </div>
                    <div class="controls hidden weekend-input">
                        <i class="glyphicons-icon clock modal-icon"></i>
                        <select id="weekend-times" multiple="multiple" placeholder="Enter weekend times" class="input-modal tokenfield" name="weekend-times"></select>
                        <div class='range-picker'>
                            <span id="weekend-range-from">08:00</span>
                            &nbsp;&nbsp;&nbsp;
                            <input id="weekend-range-select" data-slider-id="weekend-slider" type="text">
                            &nbsp;&nbsp;&nbsp;
                            <span id="weekend-range-to">17:15</span>
                        </div>
                        <input type="button" id="log-weekend-time" name='range-logger' value="Log time" class="btn btn-info"/>
                    </div>
                </div>
                <div id='seasonality-controls' class=routine-controls'>
                    <div>
                        <label for="seasonality">Seasonalities</label>
                        <a href="#"><i id='seasonality' class="icon-chevron-down"></i></a>
                    </div>
                    <div class="controls seasonality-input hidden diversification-border">
                        <i class="glyphicons-icon calendar modal-icon"></i>
                        <input placeholder="Weekday season start..." type="text" name="weekday_seasonality_start" class="datepicker">
                        <i class="glyphicons-icon calendar modal-icon"></i>
                        <input placeholder="Weekday season end..." type="text" name="weekday_seasonality_end" class="datepicker">
                    </div>
                    <div class="controls seasonality-input hidden">
                        <i class="glyphicons-icon calendar modal-icon"></i>
                        <input placeholder="Weekend season start..." type="text" name="weekend_seasonality_start" class="datepicker">
                        <i class="glyphicons-icon calendar modal-icon"></i>
                        <input placeholder="Weekend season start..." type="text" name="weekend_seasonality_end" class="datepicker">
                    </div>
                </div>
            </div>
        </form>
        <div class="modal-footer">
                <a href="#" class="btn btn-edit" data-dismiss="modal">Cancel</a>
                <button type="submit" class="btn btn-info" id="submitRoutine" value="add">Save</button>
        </div>
    </div>

    <!-- Modal for User's info editing -->
    <div class="modal fade" id="editinfo">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header box-header blueNavy">
                    <button type="button" class="close" data-dismiss="modal">×</button>
                    <h2><i class="halflings-icon edit white"></i><span class="break" ></span>Edit Account Information</h2>
                </div>
                <form action="{% url 'settings' %}" method="post" name="editinfoForm" id="editinfoForm">
                    {% csrf_token %}
                    <div class="modal-body row">
                        <h3 class="col-xs-10 col-xs-offset-2 "> Here you can modify all kind of personal information</h3>
                        <hr class="col-xs-8 col-xs-offset-2">
                        <div class="left-inner-addon col-sm-6 col-sm-offset-3">
                            <span class="glyphicon glyphicon-user" aria-hidden="true"></span>
                            <input class="input-lg form-control" name="username" type="text" value="{{ username }}" />
                        </div>
                        <div class="left-inner-addon col-sm-6 col-sm-offset-3">
                            <span class="glyphicon glyphicon-user" aria-hidden="true"></span>
                            <input class="input-lg form-control" name="firstname" type="text" value="{{ firstname }}" />
                        </div>
                        <div class="left-inner-addon col-sm-6 col-sm-offset-3">
                            <span class="glyphicon glyphicon-user" aria-hidden="true"></span>
                            <input class="input-lg form-control" name="lastname" type="text" value="{{ lastname }}" />
                        </div>
                        <div class="left-inner-addon col-sm-6 col-sm-offset-3">
                            <span class="glyphicon glyphicon-envelope" aria-hidden="true"></span>
                            <input class="input-lg form-control"  disabled name="email" type="text" value="{{ email }}"/>
                        </div>
                        <div class="left-inner-addon col-sm-6 col-sm-offset-3">
                            <span class="glyphicon glyphicon-calendar" aria-hidden="true"></span>
                            <input placeholder="{{ birth }}" type="text" name="birthday" value ="{{ birth }}"class="datepicker input-lg form-control" >
                        </div>
                        <div class="col-sm-6 col-sm-offset-5">
                            <select name="gender" class="input-sm text-center">
                                {% if gender == 'M' %}
                                    <option value="M" selected >Male</option>
                                    <option value="F">Female</option>
                                {% else %}
                                    <option value="M">Male</option>
                                    <option value="F" selected >Female</option>
                                {% endif %}
                            </select>
                        </div>
                        <div class="col-xs-12 text-center error-message">
                                <h3 id="editinfomsg"></h3>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <a href="#" class="btn btn-blueNavy" data-dismiss="modal">Cancel</a>
                        <input type="submit" class="btn btn-blueNavy" name="submitEdit" value="Update">
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal to change the password -->
    <div class="modal fade" id="changepassword">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header box-header blueNavy">
                    <button type="button" class="close" data-dismiss="modal">×</button>
                    <h2><i class="halflings-icon lock white"></i><span class="break" ></span>Change Account Passowrd</h2>
                </div>
                <form action="{% url 'settings' %}" method="post" id="passchangeForm" name="passchangeForm">
                    {% csrf_token %}
                    <div class="modal-body row">
                        <h3 class="col-xs-10 col-xs-offset-1 text-center">
                            {% if social_login %}
                                Set a password, so you can enter without using social media:
                            {% else %}
                                Change your password easily by filling the fields bellow:
                            {% endif %}
                        </h3>
                        <p class="col-xs-10 col-xs-offset-1 text-center" style="font-style: italic">
                            (Performing this will log you out of all devices for safety)
                        </p>
                        <hr class="col-xs-8 col-xs-offset-2">

                        <div class="left-inner-addon col-sm-6 col-sm-offset-3 {% if social_login %}hidden{% endif %}">
                            <span class="glyphicon glyphicon-lock" aria-hidden="true"></span>
                            <input class="input-lg form-control" name="old_password" type="password" placeholder="current password"/>
                        </div>

                        <div class="left-inner-addon col-sm-6 col-sm-offset-3">
                            <span class="glyphicon glyphicon-lock" aria-hidden="true"></span>
                            <input class="input-lg form-control" name="new_password" type="password" placeholder="new password"/>
                        </div>
                        <div class="left-inner-addon col-sm-6 col-sm-offset-3">
                            <span class="glyphicon glyphicon-lock" aria-hidden="true"></span>
                            <input class="input-lg form-control " name="new_password_repeat" type="password" placeholder="repeat new password"/>
                        </div>
                        <div class="col-xs-12 text-center error-message">
                            <h3 id="passchangemsg"></h3>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <a href="#" class="btn btn-blueNavy" data-dismiss="modal">Cancel</a>
                        <input type="submit" class="btn btn-blueNavy" name="submitChangepass" value="Change">
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal to delete the account -->
    <div class="modal fade" id="deleteaccount">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header box-header blueNavy">
                    <button type="button" class="close" data-dismiss="modal">×</button>
                    <h2><i class="halflings-icon ban-circle white"></i><span class="break" ></span>Delete Account</h2>
                </div>
                <form action="{% url 'settings' %}" method="post" id="deleteaccountForm" name="deleteaccountForm" >
                    {% csrf_token %}
                    <div class="modal-body row">
                        <h3 class="col-xs-10 col-xs-offset-1 text-center">
                            To delete your account type your password and click "Delete":
                        </h3>

                        <div class="left-inner-addon col-sm-6 col-sm-offset-3" title="Password">
                            <span class="glyphicon glyphicon-lock" aria-hidden="true"></span>
                            <input class="input-lg form-control" name="password" type="password" placeholder="current password"/>
                        </div>

                        <div class="col-xs-12 text-center error-message">
                                <h3 id="deleteaccountmsg"></h3>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <a href="#" class="btn btn-blueNavy" data-dismiss="modal">Cancel</a>
                        <input type="submit" class="btn btn-danger" name="submitDelete" value="Delete">
                    </div>
                </form>
            </div>
        </div>
    </div>
{% endblock %}

{% block js %}
    <script src="{% static 'bower_components/datatables/media/js/jquery.dataTables.min.js' %}"></script>
    <script src="{% static 'bower_components/datatables/media/js/dataTables.bootstrap.min.js' %}"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/responsive/1.0.7/js/dataTables.responsive.min.js"></script>
    <script src="{% static 'bower_components/bootstrap-tokenfield/dist/bootstrap-tokenfield.min.js' %}"></script>
    <script src="{% static 'activitytracker/js/bootstrap-slider.js' %}"></script>
    <script src="{% static 'activitytracker/js/custom.js' %}"></script>
    <script src="{% static 'activitytracker/js/settings.js' %}"></script>
{% endblock %}
